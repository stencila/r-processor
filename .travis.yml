language: r

r:
  - oldrel
  - release
  - devel

cache: packages

warnings_are_errors: false

jobs:
  include:
    - stage: deploy
      r: release
      r_github_packages:
        - r-lib/covr
        - r-lib/pkgdown
      script:
        - make docs
        - Rscript -e 'covr::codecov()'
      deploy:
        # Deploy documentation to Github Pages
        # See https://docs.travis-ci.com/user/deployment/pages/
        - provider: pages
          skip-cleanup: true
          github-token: $GITHUB_TOKEN
          local-dir: docs
        # Do a semantic release if necessary. See `.releaserc` for config.
        # Based on https://github.com/semantic-release/semantic-release/blob/beta/docs/recipes/travis.md#travisyml-configuration-for-non-javascript-projects
        - provider: script
          skip_cleanup: true
          script: nvm install lts/* && npx semantic-release
